!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}({7:function(t,e){!function(){"use strict";const t={total:document.getElementById("total-contributions"),campaigns:document.getElementById("campaigns-count"),first:document.getElementById("first-contribution"),recent:document.getElementById("recent-contribution"),filterCampaign:document.getElementById("filter-campaign"),filterLang:document.getElementById("filter-lang"),filterEditType:document.getElementById("filter-edit-type"),filterFrom:document.getElementById("filter-date-from"),filterTo:document.getElementById("filter-date-to"),filterSearch:document.getElementById("filter-search"),resetBtn:document.getElementById("btn-reset"),state:document.getElementById("mc-state"),tbody:document.getElementById("contrib-tbody"),pagination:document.getElementById("mc-pagination")};let e,n,o,a=[],r=[],i=1;function c(){t.filterCampaign&&fetch("/api/campaigns?length=200&start=0&order_col=0&order_dir=asc").then(t=>t.ok?t.json():Promise.reject()).then(t=>{const e=(t&&t.data?t.data:[]).map(t=>function(t){if(!t)return"";const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector("strong");return((n?n.textContent:e.textContent)||"").trim()}(t.campaign_html)).filter(Boolean);l([...new Set(e)].sort())}).catch(()=>{l([])})}function l(e){const n=t.filterCampaign;if(!n)return;n.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="Any",n.appendChild(o),e.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,n.appendChild(e)})}function d(){t.state.textContent="Loading…",fetch("/api/user/contributions").then(t=>t.ok?t.json():Promise.reject()).then(t=>u(t.data||t)).catch(()=>u(Array.from({length:100},(t,e)=>({date:`2024-0${e%9+1}-01`,campaign:["Birds","Nature"][e%2],file:`File_${e}.jpg`,edit_type:["caption","rotate"][e%2],country:"US",lang:"en"}))))}function u(e){a=e,function(e){const n=t.filterLang;if(!n)return;const o=n.querySelector("option"),a=o&&o.textContent||"Any",r=[...new Set(e.map(t=>(t.lang||"").trim()).filter(Boolean))].sort((t,e)=>t.localeCompare(e));n.innerHTML="";const i=document.createElement("option");i.value="",i.textContent=a,n.appendChild(i),r.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,n.appendChild(e)})}(a),document.querySelectorAll(".mc-filter-input").forEach(t=>t.addEventListener("input",s)),t.filterSearch.addEventListener("input",function(t,e){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>t(...o),e)}}(s,300)),t.resetBtn.addEventListener("click",()=>{document.querySelectorAll(".mc-filter-input").forEach(t=>t.value=""),s()}),s(),t.state.textContent=""}function s(){const c=t.filterSearch.value.toLowerCase(),l=t.filterFrom.value,d=t.filterTo.value,u=l?new Date(l):null,s=d?new Date(d):null;if(u&&s&&u>s)return t.state.textContent="Start date must be on or before end date",void(r=[]);t.state.textContent="",r=a.filter(e=>(!t.filterCampaign.value||e.campaign===t.filterCampaign.value)&&((!t.filterLang.value||e.lang===t.filterLang.value)&&((!t.filterEditType.value||e.edit_type===t.filterEditType.value)&&(!(u&&new Date(e.date)<u)&&(!(s&&new Date(e.date)>s)&&!(c&&!e.file.toLowerCase().includes(c))))))),function(){t.total.textContent=r.length,t.campaigns.textContent=new Set(r.map(t=>t.campaign)).size;const e=r.map(t=>t.date).sort();t.first.textContent=e[0]||"—",t.recent.textContent=e[e.length-1]||"—"}(),[e,n,o].forEach(t=>t&&t.destroy()),e=new Chart(document.getElementById("chart-time"),{type:"line",data:m(),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}}}),n=new Chart(document.getElementById("chart-campaign"),{type:"doughnut",data:f("campaign"),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}}}),o=new Chart(document.getElementById("chart-edit-type"),{type:"bar",data:f("edit_type"),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}}}),i=1,function(){if(t.tbody.innerHTML="",!r.length)return void(t.state.textContent="No contributions found");t.state.textContent="",r.slice(10*(i-1),10*i).forEach(e=>{const n=(e.file||"").replace(/^File:/i,""),o="https://commons.wikimedia.org/wiki/File:"+encodeURIComponent(n),a=e.campaign_id?"/campaigns/"+e.campaign_id:null;t.tbody.insertAdjacentHTML("beforeend",`<tr>\n            <td>${e.date}</td>\n            <td>${a?`<a href="${a}" target="_blank" rel="noopener noreferrer">${e.campaign}</a>`:e.campaign}</td>\n            <td><a href="${o}" target="_blank" rel="noopener noreferrer">${e.file}</a></td>\n            <td>${e.edit_type}</td>\n            <td>${e.country}</td>\n            <td>${e.lang}</td>\n          </tr>`)})}()}function m(){const t={};return r.forEach(e=>{const n=e.date.slice(0,7);t[n]=(t[n]||0)+1}),{labels:Object.keys(t),datasets:[{label:"Contributions",data:Object.values(t)}]}}function f(t){const e={};return r.forEach(n=>e[n[t]]=(e[n[t]]||0)+1),{labels:Object.keys(e),datasets:[{data:Object.values(e)}]}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{c(),d()}):(c(),d())}()}});