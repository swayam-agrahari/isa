{% extends "main/layout.html" %} {% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-sm border-0 mb-5">
        <div class="card-header bg-white border-0 text-center pt-4">
          <h1 class="h3 mb-0">
            {% if is_update %} {{ _('Update Campaign Details') }} {% else %} {{
            _('Create New Campaign') }} {% endif %}
          </h1>
          <hr class="mx-auto" width="30%" />
          <p class="text-muted mb-0">
            {% if is_update %} {{ _('You are updating %(campaign)s',
            campaign=campaign.campaign_name) }} {% else %} {{ _('Fill in the
            form below to create your campaign') }} {% endif %}
            <br />
            <small class="text-danger"
              >{{ _('Fields marked with * are mandatory') }}</small
            >
          </p>
        </div>

        <div class="card-body px-4 px-md-5 py-4">
          <form method="POST" action="">
            {{ form.csrf_token }}

            <!-- Campaign Name -->
            <div class="form-group mb-4">
              <label for="campaign_name" class="font-weight-bold"
                >{{ _('Campaign Name') }}*</label
              >
              {% if form.campaign_name.errors %} {{
              form.campaign_name(class="form-control is-invalid") }}
              <div class="invalid-feedback">
                {% for error in form.campaign_name.errors %}
                <span>{{ error }}</span>
                {% endfor %}
              </div>
              {% else %} {{ form.campaign_name(class="form-control") }} {% endif
              %}
              <small class="form-text text-muted">
                {{ _('This is the name specific to your campaign, not the main
                project.') }} {{ _('Example: "Music and Dance in Nigeria"
                instead of "Wiki Loves Africa"') }}
              </small>
            </div>
            <hr class="my-4" />

            <!-- Short Description -->
            <div class="form-group mb-4">
              <label for="short_description" class="font-weight-bold">
                {{ _('Short Description (144 characters max)') }}
                <i
                  class="fas fa-info-circle text-primary ml-1"
                  data-toggle="tooltip"
                  title="{{ _('Brief summary of what users will be working on') }}"
                ></i>
              </label>
              {% if form.short_description.errors %} {{
              form.short_description(class="form-control is-invalid") }}
              <div class="invalid-feedback">
                {% for error in form.short_description.errors %}
                <span>{{ error }}</span>
                {% endfor %}
              </div>
              {% else %} {{ form.short_description(class="form-control") }} {%
              endif %}
              <div class="d-flex justify-content-between">
                <small class="form-text text-muted"
                  >{{ _('What users will be working on') }}</small
                >
                <small class="text-muted"
                  ><span id="short_desc_counter">0</span>/144</small
                >
              </div>
            </div>
            <hr class="my-4" />

            <!-- Date Range -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="start_date" class="font-weight-bold"
                    >{{ _('Start Date') }}*</label
                  >
                  <div
                    class="input-group date"
                    id="datetimepicker1"
                    data-target-input="nearest"
                  >
                    {% if form.start_date.errors %} {{
                    form.start_date(class="form-control datetimepicker-input
                    is-invalid", data_target="#datetimepicker1") }}
                    <div class="invalid-feedback">
                      {% for error in form.start_date.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% else %} {{ form.start_date(class="form-control
                    datetimepicker-input", data_target="#datetimepicker1") }} {%
                    endif %}
                    <div
                      class="input-group-append"
                      data-target="#datetimepicker1"
                      data-toggle="datetimepicker"
                    >
                      <div class="input-group-text">
                        <i class="fas fa-calendar-alt"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="end_date" class="font-weight-bold"
                    >{{ _('End Date') }}</label
                  >
                  <div
                    class="input-group date"
                    id="datetimepicker2"
                    data-target-input="nearest"
                  >
                    {% if form.end_date.errors %} {{
                    form.end_date(class="form-control datetimepicker-input
                    is-invalid", data_target="#datetimepicker2") }}
                    <div class="invalid-feedback">
                      {% for error in form.end_date.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% else %} {{ form.end_date(class="form-control
                    datetimepicker-input", data_target="#datetimepicker2") }} {%
                    endif %}
                    <div
                      class="input-group-append"
                      data-target="#datetimepicker2"
                      data-toggle="datetimepicker"
                    >
                      <div class="input-group-text">
                        <i class="fas fa-calendar-alt"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr class="my-4" />

            <!-- Wiki Loves Campaign -->
            <div class="form-group mb-4">
              <div class="custom-control custom-switch">
                {% if form.campaign_type.errors %} {{
                form.campaign_type(class="custom-control-input is-invalid") }}
                <div class="invalid-feedback">
                  {% for error in form.campaign_type.errors %}
                  <span>{{ error }}</span>
                  {% endfor %}
                </div>
                {% else %} {{ form.campaign_type(class="custom-control-input")
                }} {% endif %}
                <label
                  class="custom-control-label font-weight-bold"
                  for="campaign_type"
                >
                  {{ _('This is a Wiki Loves Campaign') }}
                  <i
                    class="fas fa-info-circle text-primary ml-1"
                    data-toggle="tooltip"
                    title="{{ _('Enables country-specific features for Wiki Loves campaigns') }}"
                  ></i>
                </label>
              </div>
              <small class="form-text text-muted">
                {{ _('Requires categories formatted like: "Images from Wiki
                Loves Africa 2019"') }}
              </small>
              <div class="invalid-feedback invalid-wiki-loves-warning mt-2">
                <p class="mb-0 text-danger">
                  <i class="fas fa-exclamation-triangle mr-1"></i>
                  {{ _('Some selected categories don\'t match Wiki Loves
                  format') }}
                </p>
              </div>
            </div>
            <hr class="my-4" />

            <!-- Categories Selection -->
            <div class="form-group mb-4">
              <label for="category-search" class="font-weight-bold">
                {{ _('Categories to use in this campaign') }}*
                <i
                  class="fas fa-info-circle text-primary ml-1"
                  data-toggle="tooltip"
                  title="{{ _('Search for Wikimedia Commons categories containing images for your campaign') }}"
                ></i>
              </label>

              {% if form.categories.errors %} {{
              form.categories(class="form-control is-invalid d-none") }}
              <div class="invalid-feedback">
                {% for error in form.categories.errors %}
                <span>{{ error }}</span>
                {% endfor %}
              </div>
              {% else %} {{ form.categories(id="categories-data",
              class="form-control d-none") }} {% endif %} {{
              form.campaign_images(id="campaign-image-count",
              class="form-control d-none") }}

              <div class="input-group mb-3">
                <select id="category-search" class="form-control"></select>
                <div class="input-group-append">
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="add-category-btn"
                  >
                    <i class="fas fa-plus"></i> {{ _('Add') }}
                  </button>
                </div>
              </div>

              <div class="table-responsive">
                <table class="table table-hover table-sm">
                  <thead class="thead-light">
                    <tr>
                      <th width="60%">{{ _('Category') }}</th>
                      <th width="30%">{{ _('Depth') }}</th>
                      <th width="10%"></th>
                    </tr>
                  </thead>
                  <tbody id="selected-categories-content">
                    <!-- Populated by JavaScript -->
                  </tbody>
                </table>
              </div>

              <div class="d-flex justify-content-between align-items-center">
                <small class="form-text text-muted">
                  {{ _('Total images:') }}
                  <span id="total-images-count">0</span>
                </small>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger"
                  id="clear-categories-btn"
                >
                  <i class="fas fa-trash-alt mr-1"></i> {{ _('Clear All') }}
                </button>
              </div>
            </div>
            <hr class="my-4" />

            <!-- Metadata Collection -->
            <div class="form-group mb-4">
              <h5 class="font-weight-bold mb-3">
                {{ _('Metadata to Collect') }}*
                <i
                  class="fas fa-info-circle text-primary ml-1"
                  data-toggle="tooltip"
                  title="{{ _('Select what information to collect about the images') }}"
                ></i>
              </h5>

              <div class="row">
                <div class="col-md-6">
                  <div class="custom-control custom-checkbox mb-3">
                    {% if form.depicts_metadata.errors %} {{
                    form.depicts_metadata(class="custom-control-input
                    is-invalid") }}
                    <div class="invalid-feedback">
                      {% for error in form.depicts_metadata.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% else %} {{
                    form.depicts_metadata(class="custom-control-input") }} {%
                    endif %}
                    <label
                      class="custom-control-label font-weight-bold"
                      for="depicts_metadata"
                    >
                      {{ _('Depicts') }}
                      <i
                        class="fas fa-info-circle text-primary ml-1"
                        data-toggle="tooltip"
                        title="{{ _('What objects/people/concepts are shown in the image') }}"
                      ></i>
                    </label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="custom-control custom-checkbox mb-3">
                    {% if form.captions_metadata.errors %} {{
                    form.captions_metadata(class="custom-control-input
                    is-invalid") }}
                    <div class="invalid-feedback">
                      {% for error in form.captions_metadata.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% else %} {{
                    form.captions_metadata(class="custom-control-input") }} {%
                    endif %}
                    <label
                      class="custom-control-label font-weight-bold"
                      for="captions_metadata"
                    >
                      {{ _('Captions') }}
                      <i
                        class="fas fa-info-circle text-primary ml-1"
                        data-toggle="tooltip"
                        title="{{ _('Descriptive text about the image') }}"
                      ></i>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <hr class="my-4" />

            <!-- Campaign Image -->
            <div class="form-group mb-4">
              <label for="campaign_image" class="font-weight-bold">
                {{ _('Campaign Image') }}
                <i
                  class="fas fa-info-circle text-primary ml-1"
                  data-toggle="tooltip"
                  title="{{ _('Banner image or logo (max height: 150px)') }}"
                ></i>
              </label>
              {% if form.campaign_image.errors %} {{
              form.campaign_image(class="form-control is-invalid") }}
              <div class="invalid-feedback">
                {% for error in form.campaign_image.errors %}
                <span>{{ error }}</span>
                {% endfor %}
              </div>
              {% else %} {{ form.campaign_image(class="form-control") }} {%
              endif %}
              <small class="form-text text-muted">
                {{ _('Enter the Wikimedia Commons filename (e.g.
                "Example.jpg")') }}
              </small>
              <div class="mt-2" id="image-preview-container"></div>
            </div>
            <hr class="my-4" />

            <!-- Long Description -->
            <div class="form-group mb-4">
              <label for="long_description" class="font-weight-bold"
                >{{ _('Full Description') }}</label
              >
              {% if form.long_description.errors %} {{
              form.long_description(class="form-control is-invalid", rows=5) }}
              <div class="invalid-feedback">
                {% for error in form.long_description.errors %}
                <span>{{ error }}</span>
                {% endfor %}
              </div>
              {% else %} {{ form.long_description(class="form-control", rows=5)
              }} {% endif %}
              <small class="form-text text-muted">
                {{ _('Explain the importance and goals of this campaign') }}
              </small>
            </div>

            <!-- Update Images Option -->
            {% if is_update %}
            <div class="form-group mb-4">
              <div class="custom-control custom-checkbox">
                {{ form.update_images(class="custom-control-input") }}
                <label
                  class="custom-control-label font-weight-bold"
                  for="update_images"
                >
                  {{ _('Update images from categories') }}
                </label>
              </div>
              <small class="form-text text-muted">
                {{ _('Refresh the image list from selected categories (replaces
                current images)') }}
              </small>
            </div>
            {% endif %}

            <!-- Submit Button -->
            <div class="form-group text-center mt-5">
              <button
                type="submit"
                class="btn btn-primary btn-lg px-5"
                id="submit-btn"
              >
                {% if is_update %} {{ _('Update Campaign') }} {% else %} {{
                _('Create Campaign') }} {% endif %}
              </button>
              <div id="category-checking-notice" class="mt-3 d-none">
                <div class="spinner-border text-primary" role="status">
                  <span class="sr-only">{{ _('Loading...') }}</span>
                </div>
                <p class="mt-2 mb-0">{{ _('Validating categories...') }}</p>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hidden i18n Text -->
<div class="hidden-i18n-text">
  { "You must select at least one category for your campaign.": {{ _('You must
  select at least one category for your campaign.')|tojson }}, "Some of the
  categories you have chosen do not have the correct syntax for a Wiki Loves
  Campaign.": {{ _('Some of the categories you have chosen do not have the
  correct syntax for a Wiki Loves Campaign.')|tojson }}, "Please check your
  selections and try again.": {{ _('Please check your selections and try
  again.')|tojson }}, "Please select at least one type from the Metadata to
  collect section": {{ _('Please select at least one type from the Metadata to
  collect section')|tojson }}, "Category already added": {{ _('Category already
  added')|tojson }}, "Remove": {{ _('Remove')|tojson }} }
</div>
{% endblock content %} {% block scripts %}
<link
  rel="stylesheet"
  href="https://tools-static.wmflabs.org/cdnjs/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css"
/>
<script
  type="text/javascript"
  src="https://tools-static.wmflabs.org/cdnjs/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"
></script>
<script src="{{url_for('static', filename='js/campaign-form.js')}}"></script>

<script>
  $(document).ready(function () {
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip({
      html: true,
    });

    // Character counter for short description
    $("#short_description")
      .on("input", function () {
        const count = $(this).val().length;
        $("#short_desc_counter").text(count);
      })
      .trigger("input");

    // Initialize datetime pickers
    $("#datetimepicker1").datetimepicker({
      format: "YYYY-MM-DD",
      useCurrent: false,
    });

    $("#datetimepicker2").datetimepicker({
      format: "YYYY-MM-DD",
      useCurrent: false,
    });

    // Linked datetime pickers
    $("#datetimepicker1").on("change.datetimepicker", function (e) {
      $("#datetimepicker2").datetimepicker("minDate", e.date);
    });

    $("#datetimepicker2").on("change.datetimepicker", function (e) {
      $("#datetimepicker1").datetimepicker("maxDate", e.date);
    });
  });
</script>
{% endblock scripts %}

<style>
  .card {
    border-radius: 12px;
    overflow: hidden;
  }

  .form-control,
  .custom-select {
    border-radius: 8px;
    padding: 12px 15px;
  }

  .custom-control-input:checked ~ .custom-control-label::before {
    background-color: #4361ee;
    border-color: #4361ee;
  }

  .btn-primary {
    background-color: #4361ee;
    border-color: #4361ee;
    padding: 10px 25px;
    border-radius: 8px;
    font-weight: 600;
  }

  .btn-primary:hover {
    background-color: #3a0ca3;
    border-color: #3a0ca3;
  }

  .invalid-wiki-loves-warning {
    display: none;
  }

  #image-preview-container img {
    max-height: 150px;
    max-width: 100%;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .table th {
    border-top: none;
  }

  #category-search {
    height: auto;
    padding: 12px 15px;
  }

  .select2-container--default .select2-selection--single {
    height: auto;
    padding: 12px 15px;
    border-radius: 8px;
  }

  .select2-container--default
    .select2-selection--single
    .select2-selection__arrow {
    height: 100%;
  }

  @media (max-width: 768px) {
    .card-body {
      padding: 1.5rem;
    }
  }
</style>
