{% extends "main/layout.html" %}
{% block content%}
<style>
    /* 1. Global Layout & Footer Fix */
    html, body {
        height: 100%;
        margin: 0;
    }
    body {
        display: flex;
        flex-direction: column;
        background-color: #f8f9fa;
        padding-bottom: 0 !important;
    }
    .container {
        flex: 1 0 auto;
        width: 100%;
    }

    /* 2. UI Elements & Overlays */
    .hidden-i18n-text {
        display: none !important;
        visibility: hidden;
    }

    .loading {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 2000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* 3. Image Viewer */
    .image-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #e9ecef;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 10px;
        position: relative;
    }
    .img-holder img { 
        max-width: 100%; 
        max-height: 500px; 
        display: block; 
        margin: auto; 
    }

    /* 4. Search Bar & Select2 Fixes */
    .depicts-search {
        display: block !important;
        width: 100%;
        margin: 20px 0px 0px 0px;
        position: relative;
        z-index: 1050 !important;
    }
    .input-group>.select2-container--default {
        flex: 1 1 auto !important;
        width: 1% !important;
        position: relative;
    }

    .input-group>.select2-container--default .select2-selection--single {
        height: 100% !important;
        min-height: 38px;
        line-height: inherit;
        border: 1px solid #ced4da;
        border-radius: 0 0.25rem 0.25rem 0;
        padding: 5px;
        display: flex;
        align-items: center;
    }

    .select2-selection__rendered {
        padding-left: 0 !important;
        /* Fix alignment */
        line-height: normal !important;
        color: #495057 !important;
    }

    .select2-selection__arrow {
        height: 100% !important;
        top: 0 !important;
    }

    .select2-container--open {
        z-index: 9999 !important;
    }

    /* 5. Depicts Tags - Pretty Chip Cards */
    .depict-tag-group {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
    }

    .depict-tag-item {
        display: inline-grid !important;
        grid-auto-flow: column;
        grid-auto-columns: max-content;
        align-items: center;
        column-gap: 6px;

        padding: 4px 8px;
        background-color: #0b6a8f;
        color: #ffffff;
        border-radius: 6px;

        white-space: nowrap !important;
    }

    .depict-tag-label {
        display: contents !important;
    }

    .depict-tag-item a {
        font-weight: 600;
        font-size: 0.9rem;
        color: #ffffff !important;
        text-decoration: underline;
        white-space: nowrap;
    }

    .depict-tag-qvalue {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.8);
    }


    .depict-tag-label .label,
    .depict-tag-label .label.btn-sm {
        display: contents !important;
    }

    .prominent-btn,
    .depict-tag-btn {
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        min-width: 22px;
        padding: 0 !important;
        margin: 0 !important;
        font-size: 0.85rem;
        line-height: 1;
        border-radius: 4px;
        border: none;
        background: transparent;
        cursor: pointer;
    }

    .prominent-btn {
        color: #ffffff;
    }

    .prominent-btn.active {
        background-color: #ffcc00;
    }

    .depict-tag-btn {
        color: #ffffff;
        opacity: 0.85;
    }

    .depict-tag-btn:hover {
        background-color: rgba(220, 53, 69, 0.3);
    }
    /* 6. Footer Navigation */
    .participate-nav-footer {
        flex-shrink: 0;
        background: white;
        padding: 15px 0;
        border-top: 1px solid #dee2e6;
    }

    @media (min-width: 992px) {
        .desktop-img-nav { display: inline-flex; }
    }
</style>
<div class="loading">
    <div class="spinner-border text-secondary" role="status"></div>
    <img src="{{ url_for('static', filename='ISA-Structured-Data-logo_landscape_white.png') }}" height="50" class="mt-2">
</div>

<div class="isa-flash-message alert alert-success alert-danger fade"></div>

<div class="container mt-3">
    <a href="{{url_for('campaigns.getCampaignById', id=campaign.id ) }}" class="btn btn-outline-secondary btn-sm mb-3">
        <i class="fas fa-caret-left"></i> {{ campaign.campaign_name }}: {{ _('Home Page') }}
    </a>

    <div class="image-wrapper shadow-sm">
        <button class="previous-image-btn btn btn-link btn-lg desktop-img-nav"><i class="fas fa-chevron-left"></i></button>
        <div class="img-holder">
            <img src="{{url_for('static',filename='default.jpg')}}" alt="Campaign Image" id="campaign-image">
            <div class="image-overlay px-3 py-2 small bg-dark text-white text-center">
                <span id="image_author"></span> | <span id="image_credit">{{ _('Own work') }}</span> | 
                <span id="image_license"><a href="#" class="text-info" target="_blank">CC BY-SA 4.0</a></span>
            </div>
        </div>
        <button class="next-image-btn btn btn-link btn-lg desktop-img-nav"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="card mt-2 shadow-sm">
        <div class="card-body p-3">
            <div id="edit_image_info">
                <div class="image-desc small">
                    <p class="mb-1"><strong>{{ _('File') }}:</strong> <span id="image_name"></span></p>
                    <p class="mb-1"><strong>{{ _('Description') }}:</strong> <span id="image_description"></span></p>
                    <p class="mb-1"><strong>{{ _('Categories') }}:</strong> <span id="image_categories"></span></p>
                    <p class="mb-0"><strong>{{ _('Camera Location') }}:</strong> <span id="image_camera_location"></span></p>
                </div>
                <div class="text-center mt-2">
                    <button id="expand-meta-data" class="btn btn-sm btn-outline-primary border-0"><i class="fas fa-caret-down"></i> {{ _('show all metadata from Commons') }}</button>
                </div>
            </div>
        </div>
    </div>

    {% if campaign.depicts_metadata %}
    <div class="edit-box mb-2">
        <div class="edit-box-header d-flex justify-content-between align-items-center ">
            <h4 class="mt-2">{{ _('Depicts') }}</h4>
            <div edit-type="depicts" class="edit-publish-btn-group">
                <button class="btn btn-sm btn-link cancel-edits-btn" disabled>{{ _('Cancel') }}</button>
                <button class="btn btn-sm btn-primary publish-edits-btn" disabled>{{ _('Save') }}</button>
            </div>
        </div>
        <p class="text-muted small">{{ _('Name the different elements that you can see in this image') }}</p>
         <div class="depicts-search mt-1">
            <div class="input-group">
                <div class="input-group-prepend"> <span class="input-group-text"><i class="fas fa-search"></i></span> </div>
                <select id="depicts-select" class="form-control"></select>
            </div>
        </div>

        <div id="depict-tag-suggestions-container" class="mt-3 bg-light p-2 rounded">
            <div id="suggest-toggle" style="cursor: pointer;">
                <i id="toggle-indicator" class="fas fa-caret-up"></i>
                <span id="toggle-label" class="font-weight-bold">{{ _('Hide Suggestions') }}</span>
            </div>
            <div class="depict-tag-suggestions mt-2"></div>
        </div>
        <div class="depict-tag-group mt-3 d-flex flex-wrap"></div>
    </div>
    {% endif %}

    {% if campaign.captions_metadata %}
    <div class="edit-box ">
        <div class="edit-box-header d-flex justify-content-between align-items-center">
            <h4 class="mt-2">{{ _('Captions') }}</h4>
            <div edit-type="captions" class="edit-publish-btn-group">
                <button class="btn btn-sm btn-link cancel-edits-btn" disabled>{{ _('Cancel') }}</button>
                <button class="btn btn-sm btn-primary publish-edits-btn" disabled>{{ _('Save') }}</button>
            </div>
        </div>
        <div class="caption-search mt-1">
            {% for lang_code in caption_languages %}
            <div class="input-group mb-2">
                <div class="input-group-prepend"> <span class="input-group-text font-weight-bold">{{lang_code}}</span> </div>
                <input type="text" class="form-control caption-input" lang="{{lang_code}}" placeholder="{{ _('Briefly explain what you see...') }}">
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<div class="participate-nav-footer fixed-bottom bg-white border-top p-2 d-lg-none">
    <div class="btn-group d-flex">
        <button class="previous-image-btn btn btn-primary w-100"><i class="fas fa-chevron-left"></i></button>
        <button class="next-image-btn btn btn-primary w-100"><i class="fas fa-chevron-right"></i></button>
    </div>
</div>

<div class="hidden-i18n-text">
    {
    "No images found for this campaign!": {{ _('No images found for this campaign!')|tojson }},
    "Something went wrong getting campaign images": {{ _('Something went wrong getting campaign images')|tojson }},
    "Search for things you see in the image": {{ _('Search for things you see in the image')|tojson }},
    "minimise metadata from Commons": {{ _('minimise metadata from Commons')|tojson }},
    "show all metadata from Commons": {{ _('show all metadata from Commons')|tojson }},
    "Success! Depicted items saved to Wikimedia Commons": {{ _('Success! Depicted items saved to Wikimedia
    Commons')|tojson }},
    "Success! Captions saved to Wikimedia Commons": {{ _('Success! Captions saved to Wikimedia Commons')|tojson }},
    "Oops! Something went wrong, your edits have not been saved to Wikimedia Commons": {{ _('Oops! Something went wrong,
    your edits have not been saved to Wikimedia Commons')|tojson }},
    "Are you sure you want to navigate to another image? You have unsaved changes which will be lost.": {{ _('Are you
    sure you want to navigate to another image? You have unsaved changes which will be lost.')|tojson }},
    "Click 'OK' to proceed anyway, or 'Cancel' if you want to save changes first.": {{ _("Click 'OK' to proceed anyway,
    or 'Cancel' if you want to save changes first.")|tojson }},
    "Remove this depicted item": {{ _('Remove this depicted item')|tojson }},
    "Mark this depicted item as prominent": {{ _('Mark this depicted item as prominent')|tojson }},
    "Mark this depicted item as NOT prominent": {{ _('Mark this depicted item as NOT prominent')|tojson }},
    "Suggestion removed from list": {{ _('Suggestion removed from list')|tojson }},
    "Please check that you are logged in": {{ _('Please check that you are logged in')|tojson }},
    "Oops! Suggestion might not have been removed": {{ _('Oops! Suggestion might not have been removed')|tojson }},
    "Hide Suggestions": {{ _('Hide Suggestions')|tojson }},
    "Show Suggestions": {{ _('Show Suggestions')|tojson }},
    "Are you sure you want to reject this suggestion?": {{ _('Are you sure you want to reject this suggestion?')|tojson
    }},
    "Are you sure explanation for reject suggestion": {{ _('Only do this if you are sure the suggested tag does not
    appear in the image, or would be incorrect according to Wikimedia Commons guidelines. If several users reject the
    same suggestion, it will no longer be shown.')|tojson }}
    }
</div>
{% endblock content %}
{% block scripts %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://tools-static.wmflabs.org/cdnjs/ajax/libs/jquery-zoom/1.7.21/jquery.zoom.min.js"></script>
<script src="{{url_for('static', filename='js/participate.js')}}"></script>
{% endblock scripts%}