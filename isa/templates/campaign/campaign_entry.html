{% extends "main/layout.html" %}
{% block content%}
<style>
    /* 1. Global Layout & Footer Fix */
    html, body {
        height: 100%;
        margin: 0;
    }
    body {
        display: flex;
        flex-direction: column;
        background-color: #f8f9fa;
        padding-bottom: 0 !important;
    }
    .container {
        flex: 1 0 auto;
        width: 100%;
    }

    /* 2. UI Elements & Overlays */
    .hidden-i18n-text {
        display: none !important;
        visibility: hidden;
    }

    .loading {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 2000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* 3. Image Viewer */
    .image-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #e9ecef;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 10px;
        position: relative;
    }
    .img-holder img { 
        max-width: 100%; 
        max-height: 500px; 
        display: block; 
        margin: auto; 
    }

    /* 4. Search Bar & Select2 Fixes */
    .depicts-search {
        display: block !important;
        width: 100%;
        margin: 20px 0;
        position: relative;
        z-index: 1050 !important; /* Ensures it is clickable and above other cards */
    }

    .select2-container {
        width: 100% !important;
    }

    .select2-container--open {
        z-index: 1060 !important; /* Ensures dropdown appears above everything */
    }

    /* 5. Depicts Tags - Pretty Chip Cards */
    .depict-tag-group {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
    }

    .depict-tag-item {
        display: inline-flex;
        flex-direction: column;
        background: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 12px !important;
        padding: 15px;
        min-width: 200px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.2s ease;
    }

    .depict-tag-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .depict-tag-label-text {
        font-weight: 700;
        color: #007bff;
        font-size: 1.1rem;
        margin-bottom: 2px;
    }

    .depict-tag-qvalue {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 10px;
    }
    
    /* Tag Action Icons (Flag/Trash) */
    .tag-actions {
        display: flex;
        gap: 20px;
        border-top: 1px solid #f1f1f1;
        padding-top: 10px;
    }

    .tag-actions i {
        cursor: pointer;
        font-size: 1.2rem;
        transition: color 0.2s;
    }

    .prominent-btn { color: #555; }
    .prominent-btn.active { color: #ffc107; } /* Gold flag */
    .depict-tag-btn { color: #007bff; } /* Match blue icon style */
    .depict-tag-btn:hover { color: #dc3545; } /* Red on hover for delete */

    /* 6. Footer Navigation */
    .participate-nav-footer {
        flex-shrink: 0;
        background: white;
        padding: 15px 0;
        border-top: 1px solid #dee2e6;
    }

    @media (min-width: 992px) {
        .desktop-img-nav { display: inline-flex; }
    }
</style>
<div class="loading">
    <div class="spinner-border text-secondary" role="status"></div>
    <img src="{{ url_for('static', filename='ISA-Structured-Data-logo_landscape_white.png') }}" height="50" class="mt-2">
</div>

<div class="isa-flash-message alert alert-success fade"></div>
<div class="isa-flash-message alert alert-danger fade"></div>

<div class="container mt-3">
    <a href="{{url_for('campaigns.getCampaignById', id=campaign.id ) }}" class="btn btn-outline-secondary btn-sm mb-3">
        <i class="fas fa-caret-left"></i> {{ campaign.campaign_name }}: {{ _('Home Page') }}
    </a>

    <div class="image-wrapper shadow-sm">
        <button class="previous-image-btn btn btn-link btn-lg desktop-img-nav"><i class="fas fa-chevron-left"></i></button>
        <div class="img-holder">
            <img src="{{url_for('static',filename='default.jpg')}}" alt="Campaign Image" id="campaign-image">
            <div class="image-overlay px-3 py-2 small bg-dark text-white text-center">
                <span id="image_author"></span> | <span id="image_credit">{{ _('Own work') }}</span> | 
                <span id="image_license"><a href="#" class="text-info" target="_blank">CC BY-SA 4.0</a></span>
            </div>
        </div>
        <button class="next-image-btn btn btn-link btn-lg desktop-img-nav"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="card mt-2 shadow-sm">
        <div class="card-body p-3">
            <div id="edit_image_info">
                <div class="image-desc small">
                    <p class="mb-1"><strong>{{ _('File') }}:</strong> <span id="image_name"></span></p>
                    <p class="mb-1"><strong>{{ _('Description') }}:</strong> <span id="image_description"></span></p>
                    <p class="mb-1"><strong>{{ _('Categories') }}:</strong> <span id="image_categories"></span></p>
                    <p class="mb-0"><strong>{{ _('Camera Location') }}:</strong> <span id="image_camera_location"></span></p>
                </div>
                <div class="text-center mt-2">
                    <button id="expand-meta-data" class="btn btn-sm btn-outline-primary border-0"><i class="fas fa-caret-down"></i> {{ _('show all metadata from Commons') }}</button>
                </div>
            </div>
        </div>
    </div>

    {% if campaign.depicts_metadata %}
    <div class="edit-box shadow-sm">
        <div class="edit-box-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">{{ _('Depicts') }}</h4>
            <div edit-type="depicts" class="edit-publish-btn-group">
                <button class="btn btn-sm btn-link cancel-edits-btn" disabled>{{ _('Cancel') }}</button>
                <button class="btn btn-sm btn-primary publish-edits-btn" disabled>{{ _('Save') }}</button>
            </div>
        </div>
        <p class="text-muted small mt-2">{{ _('Name the different elements that you can see in this image') }}</p>
        
        <div class="depicts-search mt-3">
            <div class="input-group">
                <div class="input-group-prepend"> <span class="input-group-text"><i class="fas fa-search"></i></span> </div>
                <select id="depicts-select" class="form-control"></select>
            </div>
        </div>

        <div id="depict-tag-suggestions-container" class="mt-3 bg-light p-2 rounded">
            <div id="suggest-toggle" style="cursor: pointer;">
                <i id="toggle-indicator" class="fas fa-caret-up"></i>
                <span id="toggle-label" class="font-weight-bold">{{ _('Hide Suggestions') }}</span>
            </div>
            <div class="depict-tag-suggestions mt-2"></div>
        </div>
        <div class="depict-tag-group mt-3 d-flex flex-wrap"></div>
    </div>
    {% endif %}

    {% if campaign.captions_metadata %}
    <div class="edit-box shadow-sm">
        <div class="edit-box-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">{{ _('Captions') }}</h4>
            <div edit-type="captions" class="edit-publish-btn-group">
                <button class="btn btn-sm btn-link cancel-edits-btn" disabled>{{ _('Cancel') }}</button>
                <button class="btn btn-sm btn-primary publish-edits-btn" disabled>{{ _('Save') }}</button>
            </div>
        </div>
        <div class="caption-search mt-3"> 
            {% for lang_code in caption_languages %}
            <div class="input-group mb-2">
                <div class="input-group-prepend"> <span class="input-group-text font-weight-bold">{{lang_code}}</span> </div>
                <input type="text" class="form-control caption-input" lang="{{lang_code}}" placeholder="{{ _('Briefly explain what you see...') }}">
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<div class="participate-nav-footer fixed-bottom bg-white border-top p-2 d-lg-none">
    <div class="btn-group d-flex">
        <button class="previous-image-btn btn btn-primary w-100"><i class="fas fa-chevron-left"></i></button>
        <button class="next-image-btn btn btn-primary w-100"><i class="fas fa-chevron-right"></i></button>
    </div>
</div>

<div class="hidden-i18n-text">
    {
        "No images found for this campaign!": {{ _('No images found for this campaign!')|tojson }},
        "Something went wrong getting campaign images": {{ _('Something went wrong getting campaign images')|tojson }},
        "Search for things you see in the image": {{ _('Search for things you see in the image')|tojson }},
        "minimise metadata from Commons": {{ _('minimise metadata from Commons')|tojson }},
        "show all metadata from Commons": {{ _('show all metadata from Commons')|tojson }},
        "Success! Depicted items saved to Wikimedia Commons": {{ _('Success! Depicted items saved to Wikimedia Commons')|tojson }},
        "Success! Captions saved to Wikimedia Commons": {{ _('Success! Captions saved to Wikimedia Commons')|tojson }},
        "Oops! Something went wrong, your edits have not been saved to Wikimedia Commons": {{ _('Oops! Something went wrong, your edits have not been saved to Wikimedia Commons')|tojson }},
        "Are you sure you want to navigate to another image? You have unsaved changes which will be lost.": {{ _('Are you sure you want to navigate to another image? You have unsaved changes which will be lost.')|tojson }},
        "Click 'OK' to proceed anyway, or 'Cancel' if you want to save changes first.": {{ _("Click 'OK' to proceed anyway, or 'Cancel' if you want to save changes first.")|tojson }},
        "Remove this depicted item": {{ _('Remove this depicted item')|tojson }},
        "Mark this depicted item as prominent": {{ _('Mark this depicted item as prominent')|tojson }},
        "Mark this depicted item as NOT prominent": {{ _('Mark this depicted item as NOT prominent')|tojson }},
        "Suggestion removed from list": {{ _('Suggestion removed from list')|tojson }},
        "Please check that you are logged in": {{ _('Please check that you are logged in')|tojson }},
        "Oops! Suggestion might not have been removed": {{ _('Oops! Suggestion might not have been removed')|tojson }},
        "Hide Suggestions": {{ _('Hide Suggestions')|tojson }},
        "Show Suggestions": {{ _('Show Suggestions')|tojson }},
        "Are you sure you want to reject this suggestion?": {{ _('Are you sure you want to reject this suggestion?')|tojson }},
        "Are you sure explanation for reject suggestion": {{ _('Only do this if you are sure the suggested tag does not appear in the image, or would be incorrect according to Wikimedia Commons guidelines. If several users reject the same suggestion, it will no longer be shown.')|tojson }}
    }
</div>
{% endblock content %}
{% block scripts %}
<script src="https://tools-static.wmflabs.org/cdnjs/ajax/libs/jquery-zoom/1.7.21/jquery.zoom.min.js"></script>
<script src="{{url_for('static', filename='js/participate.js')}}"></script>
{% endblock scripts%}
